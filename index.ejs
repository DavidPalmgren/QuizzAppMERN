const express = require('express');
const path = require('path');
const { MongoClient } = require('mongodb');
const cors = require('cors');
const app = express()

const URI = process.env.MONGO_URI
const client = new MongoClient(URI)
const database = client.db('main')
const cards = database.collection('cards')

client.connect()
console.log('connected to mongodb')

const PORT = process.env.PORT || 5555


const corsOptions = {
  origin: 'https://studyapp-dapa-98dcdc34bdde.herokuapp.com/', // Replace with your React app's domain
  methods: 'GET,POST', // Add the HTTP methods you're using
};

app.use(cors(corsOptions));

app.use(express.static(path.join(__dirname, 'frontend/my-react-app/build')));
app.use(express.json())

app.listen(PORT, () => console.log('api running'))

app.get('/api/cards', async (req, res) => {
    const allCards = await cards.find().toArray()
    res.json(allCards)
})

app.post('/api/add-card', async (req, res) => {
    const { name, favorite } = req.body;
  
    try {
      const result = await cards.insertOne({ name, favorite });
      res.status(201).json({ message: 'Item was added', insertedId: result.insertedId });
    } catch (error) {
      console.error('Error adding item:', error);
      res.status(500).json({ message: 'Error adding item' });
    }
});

app.get('*', (req, res) => {
    res.sendFile(path.join(__dirname, 'frontend/my-react-app/build', 'index.html'));
});
